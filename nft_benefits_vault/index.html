<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="near-nft-benefits-vault"><meta name="keywords" content="rust, rustlang, rust-lang, nft_benefits_vault"><title>nft_benefits_vault - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../normalize.css"><link rel="stylesheet" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../ayu.css" disabled><link rel="stylesheet" href="../dark.css" disabled><link rel="stylesheet" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../nft_benefits_vault/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../nft_benefits_vault/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate nft_benefits_vault</a></h2><div class="sidebar-elems"><div class="block"><ul><li class="version">Version 0.1.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul></div><section><div class="block"><ul><li><a href="#modules">Modules</a></li><li><a href="#structs">Structs</a></li></ul></div></section></div></nav><main><div class="width-limiter"><div class="sub-container"><a class="sub-logo-container" href="../nft_benefits_vault/index.html"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></a><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><button type="button">?</button></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></div></form></nav></div><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn"><span class="in-band">Crate <a class="mod" href="#">nft_benefits_vault</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></span></h1><span class="out-of-band"><a class="srclink" href="../src/nft_benefits_vault/lib.rs.html#1-98">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><h2 id="near-nft-benefits-vault"><a href="#near-nft-benefits-vault">near-nft-benefits-vault</a></h2>
<p><a href="https://github.com/roke-to/near-nft-benefits-vault/actions/workflows/rust.yml"><img src="https://github.com/roke-to/near-nft-benefits-vault/actions/workflows/rust.yml/badge.svg" alt="Rust" /></a></p>
<p>This contract provides functionality to increase the value and utility of NFTs.
NFT Benefits Vault allows multiple users to own a private vault for Fungible Assets accessed via the corresponding NFT.</p>
<h2 id="prerequisites"><a href="#prerequisites">Prerequisites</a></h2>
<p>Make sure Rust is installed
Make sure <code>near-cli</code> is installed</p>
<h2 id="building"><a href="#building">Building</a></h2>
<p>To build run:</p>
<div class="example-wrap"><pre class="language-sh"><code>./build.sh</code></pre></div>
<p>Compiled binary will be put in the <code>dist</code> directory:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code>./dist/nft_benefits_vault.wasm</code></pre></div>
<h2 id="testing-this-contract"><a href="#testing-this-contract">Testing this contract</a></h2>
<p>To test just run:</p>
<div class="example-wrap"><pre class="language-sh"><code>./test.sh</code></pre></div>
<p>To do it manualy, build and place the contract WASM file to the <code>dist</code> dir. Then:</p>
<div class="example-wrap"><pre class="language-sh"><code>cargo test [OPTIONS] [TESTNAME] [-- [args]...]</code></pre></div>
<p>To turn on logger start with env variable <code>RUST_LOG</code>:</p>
<div class="example-wrap"><pre class="language-sh"><code>RUST_LOG=&#39;nft_benefits_vault=debug&#39; cargo test</code></pre></div><h2 id="using-this-contract"><a href="#using-this-contract">Using this contract</a></h2><h3 id="quickest-deploy"><a href="#quickest-deploy">Quickest deploy</a></h3>
<p>Build and deploy this contract to the dev account:</p>
<div class="example-wrap"><pre class="language-sh"><code>./build.sh
near dev-deploy --wasmFile dist/nft_benefits_vault.wasm</code></pre></div>
<p><code>near-cli</code> will create new dev account and deploy wasm code to it.
The next command will initialize contract using <code>new</code> method:</p>
<div class="example-wrap"><pre class="language-sh"><code>near call $CONTRACT_ID new &#39;&#39; --accountId $CONTRACT_ID</code></pre></div><h3 id="standard-deploy"><a href="#standard-deploy">Standard deploy</a></h3>
<p>You should create an account on NEAR.
For convenience you can save account Id for the contract to the env variable.
In the below command, replace MY_ACCOUNT_NAME with the contract account name.</p>
<div class="example-wrap"><pre class="language-sh"><code>export ID=MY_CONTRACT_ID`</code></pre></div>
<p>Check env variable with:</p>
<div class="example-wrap"><pre class="language-sh"><code>echo $ID</code></pre></div>
<p>Deploy:</p>
<div class="example-wrap"><pre class="language-sh"><code>near deploy --wasmFile dist/nft_benefits_vault.wasm --accountId $ID</code></pre></div>
<p>Initialize:</p>
<div class="example-wrap"><pre class="language-sh"><code>near call $CONTRACT_ID new &#39;&#39; --accountId $CONTRACT_ID</code></pre></div>
<p>Congrats! NFT Benefits Vault is ready to use.</p>
<h3 id="contract-methods"><a href="#contract-methods">Contract methods</a></h3><h2 id="withdraw_all"><a href="#withdraw_all">withdraw_all</a></h2><h4 id="declaration"><a href="#declaration">Declaration</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub fn </span>withdraw_all(<span class="kw-2">&amp;mut </span><span class="self">self</span>, nft_contract_id: AccountId, nft_id: TokenId) -&gt; Promise {..}</code></pre></div>
<h4 id="description"><a href="#description">Description</a></h4>
<p>Public call to withdraw all FTs of every type from the Vault.
The contract will check caller ownership of the NFT specified by the NFT contract Id and NFT Id.
Then it will try to find the corresponding vault with access via provided contract/id pair.</p>
<h4 id="arguments"><a href="#arguments">Arguments</a></h4>
<p><code>nft_contract_id</code> - account id of the NFT contract.</p>
<p><code>nft_id</code> - string with unique token Id.</p>
<h4 id="deposit"><a href="#deposit">Deposit</a></h4>
<p>Exactly 1 yoctoNEAR must be attached.</p>
<h4 id="gas-consumption"><a href="#gas-consumption">Gas consumption</a></h4>
<p>@TODO</p>
<h2 id="withdraw"><a href="#withdraw">withdraw</a></h2><h4 id="declaration-1"><a href="#declaration-1">Declaration</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub fn </span>withdraw(
    <span class="kw-2">&amp;mut </span><span class="self">self</span>,
    nft_contract_id: AccountId,
    nft_id: TokenId,
    fungible_token: AccountId,
) {..}</code></pre></div>
<h4 id="description-1"><a href="#description-1">Description</a></h4>
<p>Public call to withdraw all tokens of a <strong>single</strong> type of FT from the Vault.
The contract will check ownership of the NFT spectified by the arguments.
Than it will try to find the vault with access via provided contract/id pair.
And it makes <code>ft_transfer</code> with all available tokens on the provided <code>fungible_token</code>.</p>
<h4 id="arguments-1"><a href="#arguments-1">Arguments</a></h4>
<p><code>nft_contract_id</code> - account id of the NFT contract.</p>
<p><code>nft_id</code> - string with unique token Id.</p>
<p><code>fungible_token</code> - contract account id of the FT caller wants to withdraw.</p>
<h4 id="deposit-1"><a href="#deposit-1">Deposit</a></h4>
<p>Exactly 1 yoctoNEAR must be attached.</p>
<h4 id="gas-consumption-1"><a href="#gas-consumption-1">Gas consumption</a></h4>
<p>@TODO</p>
<h2 id="withdraw_amount"><a href="#withdraw_amount">withdraw_amount</a></h2><h4 id="declaration-2"><a href="#declaration-2">Declaration</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub fn </span>withdraw_amount(
    <span class="kw-2">&amp;mut </span><span class="self">self</span>,
    nft_contract_id: AccountId,
    nft_id: TokenId,
    fungible_token: AccountId,
    amount: U128,
) {..}</code></pre></div>
<h4 id="description-2"><a href="#description-2">Description</a></h4>
<p>Public call to withdraw specified <code>amount</code> of tokens of a single type of FT from the Vault.
The contract will check ownership of the NFT spectified by the arguments.
Than it will try to find the vault with access via provided contract/id pair.
And it makes <code>ft_transfer</code> with specified amount of tokens on the provided <code>fungible_token</code>.</p>
<h4 id="arguments-2"><a href="#arguments-2">Arguments</a></h4>
<p><code>nft_contract_id</code> - account id of the NFT contract.</p>
<p><code>nft_id</code> - string with unique token Id.</p>
<p><code>fungible_token</code> - contract account id of the FT caller wants to withdraw.</p>
<p><code>amount</code> - amount of FTs to be withdrawn, must be provided as string, eg: <code>&quot;1000000000&quot;</code>.</p>
<h4 id="deposit-2"><a href="#deposit-2">Deposit</a></h4>
<p>Exactly 1 yoctoNEAR must be attached.</p>
<h4 id="gas-consumption-2"><a href="#gas-consumption-2">Gas consumption</a></h4>
<p>@TODO</p>
<h2 id="add_replenishment_callback"><a href="#add_replenishment_callback">add_replenishment_callback</a></h2><h4 id="declaration-3"><a href="#declaration-3">Declaration</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub fn </span>add_replenishment_callback(
    <span class="kw-2">&amp;mut </span><span class="self">self</span>,
    nft_contract_id: AccountId,
    nft_id: TokenId,
    callback: String,
    args: String,
) {..}</code></pre></div>
<h4 id="description-3"><a href="#description-3">Description</a></h4>
<p>This method is used to add replenishers for the Vault.
When NFT owner calls withdraw methods the Contract will transfer available tokens from its own balance and will request available benefits from registered replenishers.
This method MUST be called and signed by replenisher himself because future replenishment requests will be made to the signer account.
The Vault will make call <code>callback</code> with <code>args</code> on the <code>env::predecessor_account_id()</code>.</p>
<h4 id="arguments-3"><a href="#arguments-3">Arguments</a></h4>
<p><code>nft_contract_id</code> - account id of the NFT contract.</p>
<p><code>nft_id</code> - string with unique token Id.</p>
<p><code>callback</code> - function name of the external contract.</p>
<p><code>args</code> - serialized in json arguments will be passed to the <code>callback</code>.</p>
<h4 id="deposit-3"><a href="#deposit-3">Deposit</a></h4>
<p>Exactly 1 yoctoNEAR must be attached.</p>
<h4 id="gas-consumption-3"><a href="#gas-consumption-3">Gas consumption</a></h4>
<p>@TODO</p>
<h3 id="view-methods"><a href="#view-methods">View methods</a></h3><h2 id="structs-returned-by-view-methods"><a href="#structs-returned-by-view-methods">Structs returned by view methods</a></h2>
<p>Complete list of tokens in the Vault.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub struct </span>BalanceView {
    <span class="doccomment">/// Unique identifier of the NFT.
    </span><span class="kw">pub </span>nft_id: NftId,
    <span class="doccomment">/// List of FTs.
    </span><span class="kw">pub </span>tokens: Vec&lt;Token&gt;,
}</code></pre></div>
<p>Unique identifier of the NFT to be used as the Key to the Vault.
Only [<code>TokenId</code>] is insufficient because there can be multiple NFT contracts containing the same [<code>TokenId</code>].</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub struct </span>NftId {
    contract_id: AccountId,
    token_id: TokenId,
}</code></pre></div>
<p>Info about FT.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub struct </span>Token {
    <span class="doccomment">/// Account id of the FT contract.
    </span><span class="kw">pub </span>contract_id: AccountId,
    <span class="doccomment">/// Amount of this tokens in the Vault.
    </span><span class="kw">pub </span>amount: u128,
}</code></pre></div>
<p>Info about vault.</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub struct </span>VaultView {
    <span class="doccomment">/// Key NFT with access to the Vault.
    </span><span class="kw">pub </span>nft_id: NftId,
    <span class="doccomment">/// The number of FT types in the Vault.
    </span><span class="kw">pub </span>assets_count: u64,
}</code></pre></div>
<h2 id="balance_of"><a href="#balance_of">balance_of</a></h2><h4 id="declaration-4"><a href="#declaration-4">Declaration</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub fn </span>balance_of(<span class="kw-2">&amp;</span><span class="self">self</span>, nft_contract_id: AccountId, nft_id: TokenId) -&gt; <span class="prelude-ty">Option</span>&lt;BalanceView&gt; {..}</code></pre></div>
<h4 id="description-4"><a href="#description-4">Description</a></h4>
<p>Function to view balances of all assets in the vault.</p>
<h4 id="arguments-4"><a href="#arguments-4">Arguments</a></h4>
<p><code>nft_contract_id</code> - account id of the NFT contract.</p>
<p><code>nft_id</code> - string with unique token Id.</p>
<h2 id="vault_assets_count"><a href="#vault_assets_count">vault_assets_count</a></h2><h4 id="declaration-5"><a href="#declaration-5">Declaration</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub fn </span>vault_assets_count(
    <span class="kw-2">&amp;</span><span class="self">self</span>,
    nft_contract_id: AccountId,
    nft_id: TokenId,
) -&gt; <span class="prelude-ty">Option</span>&lt;VaultView&gt; {..}</code></pre></div>
<h4 id="description-5"><a href="#description-5">Description</a></h4>
<p>Function to view the amount of assets in the Vault.</p>
<h4 id="arguments-5"><a href="#arguments-5">Arguments</a></h4>
<p><code>nft_contract_id</code> - account id of the NFT contract.</p>
<p><code>nft_id</code> - string with unique token Id.</p>
<h2 id="replenishers"><a href="#replenishers">replenishers</a></h2><h4 id="declaration-6"><a href="#declaration-6">Declaration</a></h4>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">pub fn </span>replenishers(
    <span class="kw-2">&amp;</span><span class="self">self</span>,
    nft_contract_id: AccountId,
    nft_id: TokenId,
) -&gt; <span class="prelude-ty">Option</span>&lt;Vec&lt;Replenisher&gt;&gt; {..}</code></pre></div>
<h4 id="description-6"><a href="#description-6">Description</a></h4>
<p>Function to view the replenishers of the vault.</p>
<h4 id="arguments-6"><a href="#arguments-6">Arguments</a></h4>
<p><code>nft_contract_id</code> - account id of the NFT contract.</p>
<p><code>nft_id</code> - string with unique token Id.</p>
</div></details><h2 id="modules" class="small-section-header"><a href="#modules">Modules</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="mod" href="calls/index.html" title="nft_benefits_vault::calls mod">calls</a></div></div></div><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Contract.html" title="nft_benefits_vault::Contract struct">Contract</a></div><div class="item-right docblock-short">Core structure of the smart contract.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ContractExt.html" title="nft_benefits_vault::ContractExt struct">ContractExt</a></div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="nft_benefits_vault" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.65.0 (897e37553 2022-11-02)" ></div></body></html>